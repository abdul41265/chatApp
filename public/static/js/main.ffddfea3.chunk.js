(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{170:function(e,t,a){},229:function(e,t,a){e.exports=a(413)},234:function(e,t,a){},236:function(e,t,a){},385:function(e,t){},388:function(e,t,a){},389:function(e,t,a){},409:function(e,t,a){},410:function(e,t,a){e.exports=a.p+"static/media/cancel.fbd28b8b.jpg"},411:function(e,t,a){},413:function(e,t,a){"use strict";a.r(t);var n,r,s,i,o,c,l,u,m,h,p,f,g,b=a(0),d=a.n(b),v=a(38),y=a.n(v),k=(a(234),a(35)),O=a(36),w=a(21),E=a(22),j=a(26),N=(a(110),a(10)),S={home:{logout:"Logout",typeMessagePlaceholder:"Type a message",searchPlaceholder:"Search..."},login:{email:"Email",password:"Password",enterEmail:"Enter Email",submit:"Submit",gotoRegistration:"Create an Account"},register:{firstName:"First Name",lastName:"Last Name",gotoLogin:"Already have an account? Sign in"}},M={},x=(n=function(){function e(){Object(w.a)(this,e),Object(O.a)(this,"type",r,this),Object(O.a)(this,"translation",s,this)}return Object(E.a)(e,[{key:"changeTranslations",value:function(e){this.type=e}},{key:"getTranslation",value:function(e,t){var a=t?"?".concat(e,"-").concat(t,"?"):"?".concat(e,"?");if(e&&t&&this.translation[this.type]&&this.translation[this.type][e]&&this.translation[this.type][e][t]){var n=this.translation[this.type][e][t];if("string"===typeof n)return n}else{if(e&&t)return a;if(e){t=e;var r=this.translation[this.type][t];if(r&&"string"===typeof r)return r;for(var s in this.translation[this.type]){var i=this.translation[this.type][s];if("object"===typeof i&&t in i&&"string"===typeof i[t])return i[t]}}}return a}}]),e}(),r=Object(j.a)(n.prototype,"type",[N.l],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return"en-CA"}}),s=Object(j.a)(n.prototype,"translation",[N.l],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return{"en-CA":S,"fr-CA":M}}}),Object(j.a)(n.prototype,"changeTranslations",[N.d],Object.getOwnPropertyDescriptor(n.prototype,"changeTranslations"),n.prototype),n),T=a(220),C=(i=function(){function e(){Object(w.a)(this,e),Object(O.a)(this,"id",o,this),Object(O.a)(this,"email",c,this),Object(O.a)(this,"token",l,this),Object(O.a)(this,"firstName",u,this),Object(O.a)(this,"lastName",m,this),this.nonObservableToken=null,this.cookies=null,this.cookies=new T.a;var t=this.cookies.get("token");this.token=t,this.nonObservableToken=t,this.id=this.cookies.get("id"),this.email=this.cookies.get("email"),this.firstName=this.cookies.get("firstName"),this.lastName=this.cookies.get("lastName")}return Object(E.a)(e,[{key:"storeAuthentication",value:function(e){for(var t in this.nonObservableToken=e.token,e)this[t]=e[t],this.cookies.set(t,e[t],{path:"/",maxAge:"18000"})}},{key:"refreshAuthentication",value:function(){this.token=null,this.cookies.remove("token"),this.id=null,this.cookies.remove("id"),this.email=null,this.cookies.remove("email"),this.firstName=null,this.cookies.remove("firstName"),this.lastName=null,this.cookies.remove("lastName")}}]),e}(),o=Object(j.a)(i.prototype,"id",[N.l],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),c=Object(j.a)(i.prototype,"email",[N.l],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),l=Object(j.a)(i.prototype,"token",[N.l],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),u=Object(j.a)(i.prototype,"firstName",[N.l],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),m=Object(j.a)(i.prototype,"lastName",[N.l],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Object(j.a)(i.prototype,"storeAuthentication",[N.d],Object.getOwnPropertyDescriptor(i.prototype,"storeAuthentication"),i.prototype),Object(j.a)(i.prototype,"refreshAuthentication",[N.d],Object.getOwnPropertyDescriptor(i.prototype,"refreshAuthentication"),i.prototype),i),A=(h=function(){function e(){Object(w.a)(this,e),Object(O.a)(this,"messages",p,this)}return Object(E.a)(e,[{key:"storeMessage",value:function(e){this.messages=e}}]),e}(),p=Object(j.a)(h.prototype,"messages",[N.l],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return{}}}),Object(j.a)(h.prototype,"storeMessage",[N.d],Object.getOwnPropertyDescriptor(h.prototype,"storeMessage"),h.prototype),h),U=a(72),D=a(48),L=a(18),R=a.n(L),P=a(25),I=a(31),z=a(30),W=a(32),X=function(){function e(){Object(w.a)(this,e)}return Object(E.a)(e,null,[{key:"getRandomNumber",value:function(e,t){return Math.ceil(Math.random()*(t+1-e))}},{key:"decorateWithMobX",value:function(e){return Object(k.b)("message","authentication","translation")(Object(k.c)(function(t){return e(t)}))}}]),e}(),G=a(420),_=a(421),q=a(202),F=a(425),H=a(414),B=a(427),J=(a(236),X.decorateWithMobX(function(e){return d.a.createElement(B.a,{style:{visibility:e.show?"visible":"hidden"},compact:!0,className:"notify",floating:!0,content:e.message})})),V=(a(170),X.decorateWithMobX(function(e){var t=e.translation;return d.a.createElement(G.a,null,d.a.createElement(J,{show:e.showNotify,message:e.message}),d.a.createElement(_.a,{className:"justify-content-md-center login-container"},d.a.createElement(q.a,{md:4},d.a.createElement(F.a,{onSubmit:e.onSubmit},d.a.createElement(F.a.Group,{controlId:"email"},d.a.createElement(F.a.Label,null,t.getTranslation("email")),d.a.createElement(F.a.Control,{type:"email",placeholder:t.getTranslation("enterEmail")})),d.a.createElement(F.a.Group,{controlId:"password"},d.a.createElement(F.a.Label,null,t.getTranslation("password")),d.a.createElement(F.a.Control,{type:"password",placeholder:t.getTranslation("password")})),d.a.createElement(H.a,{type:"submit",loading:e.formSubmitted,primary:!0},t.getTranslation("submit")),d.a.createElement(F.a.Text,{className:"text-muted authentication-link"},d.a.createElement("a",{href:"/register"},t.getTranslation("gotoRegistration")))))))})),K=X.decorateWithMobX(function(e){var t=e.translation;return d.a.createElement(G.a,null,d.a.createElement(J,{show:e.showNotify,message:e.message}),d.a.createElement(_.a,{className:"justify-content-md-center register-container"},d.a.createElement(q.a,{md:4},d.a.createElement(F.a,{onSubmit:e.onSubmit},d.a.createElement(F.a.Group,{controlId:"email"},d.a.createElement(F.a.Label,null,t.getTranslation("email")),d.a.createElement(F.a.Control,{type:"email",placeholder:t.getTranslation("enterEmail")})),d.a.createElement(F.a.Group,{controlId:"password"},d.a.createElement(F.a.Label,null,t.getTranslation("password")),d.a.createElement(F.a.Control,{type:"password",placeholder:t.getTranslation("password")})),d.a.createElement(F.a.Group,{controlId:"firstName"},d.a.createElement(F.a.Label,null,t.getTranslation("firstName")),d.a.createElement(F.a.Control,{type:"text",placeholder:t.getTranslation("firstName")})),d.a.createElement(F.a.Group,{controlId:"lastName"},d.a.createElement(F.a.Label,null,t.getTranslation("lastName")),d.a.createElement(F.a.Control,{type:"text",placeholder:t.getTranslation("lastName")})),d.a.createElement(H.a,{type:"submit",loading:e.formSubmitted,primary:!0},t.getTranslation("submit")),d.a.createElement(F.a.Text,{className:"text-muted authentication-link"},d.a.createElement("a",{href:"/login"},t.getTranslation("gotoLogin")))))))}),$=a(205),Q=a.n($),Y=function(){function e(){Object(w.a)(this,e)}return Object(E.a)(e,null,[{key:"request",value:function(e){var t=e.method,a=e.url,n=e.data,r=e.token,s={method:t,url:"".concat("","/").concat(a)};return r&&(s.headers={authorization:"Bearer ".concat(r)}),n&&(s.data=n),Q()(s)}},{key:"post",value:function(e){var t=e.url,a=e.data,n=e.token;return this.request({method:"POST",url:t,data:a,token:n})}},{key:"get",value:function(e){var t=e.url,a=e.data,n=e.token;return this.request({method:"GET",url:t,data:a,token:n})}}]),e}(),Z=function(e){function t(){return Object(w.a)(this,t),Object(I.a)(this,Object(z.a)(t).apply(this,arguments))}return Object(W.a)(t,e),Object(E.a)(t,null,[{key:"parseFormData",value:function(e){var t=e.elements,a={},n=!0,r=!1,s=void 0;try{for(var i,o=t[Symbol.iterator]();!(n=(i=o.next()).done);n=!0){var c=i.value,l=c.id,u=c.value;l&&(a[l]=u)}}catch(m){r=!0,s=m}finally{try{n||null==o.return||o.return()}finally{if(r)throw s}}return a}},{key:"login",value:function(e){var t=this.parseFormData(e);return this.post({url:"login",data:t})}},{key:"register",value:function(e){var t=this.parseFormData(e);return this.post({url:"register",data:t})}},{key:"logout",value:function(e){return this.post({url:"logout",token:e})}}]),t}(Y),ee=function(e){function t(){return Object(w.a)(this,t),Object(I.a)(this,Object(z.a)(t).apply(this,arguments))}return Object(W.a)(t,e),Object(E.a)(t,null,[{key:"search",value:function(){var e=Object(P.a)(R.a.mark(function e(t,a){var n,r,s,i;return R.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n={url:"api/search/user",token:a,data:{query:{bool:{should:[{match_phrase_prefix:{firstName:t}},{match_phrase_prefix:{lastName:t}}]}}}},e.next=3,this.post(n);case 3:return r=e.sent,s=r.data.body.hits.hits,i=s.map(function(e){return e._source}),e.abrupt("return",i);case 7:case"end":return e.stop()}},e,this)}));return function(t,a){return e.apply(this,arguments)}}()}]),t}(Y),te=function(e){function t(){return Object(w.a)(this,t),Object(I.a)(this,Object(z.a)(t).apply(this,arguments))}return Object(W.a)(t,e),Object(E.a)(t,null,[{key:"getConversation",value:function(){var e=Object(P.a)(R.a.mark(function e(t,a,n,r){var s;return R.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.get({url:"api/conversation?with=".concat(t,"&page=").concat(a,"&limit=").concat(n),token:r});case 2:return s=e.sent,e.abrupt("return",s&&s.data);case 4:case"end":return e.stop()}},e,this)}));return function(t,a,n,r){return e.apply(this,arguments)}}()},{key:"sendMessage",value:function(e,t){return this.post({url:"api/message",data:e,token:t})}}]),t}(Y),ae=Object(k.b)("authentication")(f=Object(k.c)(f=function(e){function t(e){var a;return Object(w.a)(this,t),(a=Object(I.a)(this,Object(z.a)(t).call(this,e))).state={formSubmitted:!1,showNotify:!1,message:""},a}return Object(W.a)(t,e),Object(E.a)(t,[{key:"showNotification",value:function(e,t){var a=this;this.setState({showNotify:!0,formSubmitted:!1,message:e},function(){var e=setTimeout(function(){a.setState({showNotify:!1,message:""})},3e3);"function"===typeof t&&(clearTimeout(e),t())})}},{key:"storeAuthentication",value:function(e){var t=e.data;this.props.authentication.storeAuthentication(t)}},{key:"authenticate",value:function(){var e=Object(P.a)(R.a.mark(function e(t){var a,n,r=this;return R.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.props.register){e.next=8;break}return e.next=3,Z.register(t);case 3:a=e.sent,this.storeAuthentication(a),this.showNotification("Registration successful!",function(){setTimeout(function(){r.props.history.push("/home")},1e3)}),e.next=13;break;case 8:return e.next=10,Z.login(t);case 10:n=e.sent,this.storeAuthentication(n),this.showNotification("Login successful!",function(){setTimeout(function(){r.props.history.push("/home")},700)});case 13:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"onSubmit",value:function(e){var t=this;if(!0!==this.state.formSubmitted){e.preventDefault();var a=e.target;this.setState({formSubmitted:!0},Object(P.a)(R.a.mark(function e(){return R.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,t.authenticate(a);case 3:e.next=8;break;case 5:e.prev=5,e.t0=e.catch(0),t.showNotification(e.t0.message);case 8:case"end":return e.stop()}},e,null,[[0,5]])})))}}},{key:"render",value:function(){return this.props.register?d.a.createElement(K,{message:this.state.message,showNotify:this.state.showNotify,formSubmitted:this.state.formSubmitted,onSubmit:this.onSubmit.bind(this)}):d.a.createElement(V,{message:this.state.message,showNotify:this.state.showNotify,formSubmitted:this.state.formSubmitted,onSubmit:this.onSubmit.bind(this)})}}]),t}(b.Component))||f)||f,ne=Object(D.g)(ae),re=a(208),se=a(106),ie=a(209),oe=a.n(ie),ce=a(426),le=a(422),ue=a(423),me=(a(388),X.decorateWithMobX(function(e){var t="medium"===e.size?"medium":"small";return d.a.createElement("div",{className:"avatar-container avatar-".concat(t)},e.firstLetter)})),he=(a(389),X.decorateWithMobX(function(e){var t=e.translation,a=e.user,n=e.recipient,r=e.selectedUsers,s=e.messages,i=e.onLogout,o=e.onSendMessage;return d.a.createElement(G.a,{className:"home-container"},d.a.createElement(_.a,{className:"profile-tab user-profile-tab"},d.a.createElement(q.a,{className:"profile-avatar"},d.a.createElement(me,{firstLetter:a.firstName[0].toUpperCase()})),d.a.createElement(ce.a,{labeled:!0,button:!0,icon:"setting"},d.a.createElement(ce.a.Menu,null,d.a.createElement(ce.a.Item,{onClick:i,text:t.getTranslation("logout")})))),d.a.createElement(_.a,{className:"row-container"},d.a.createElement(q.a,{className:"scrollable user-container",xs:3},d.a.createElement(_.a,{className:"user-search"},d.a.createElement(q.a,null,d.a.createElement(ce.a,{onSearchChange:e.onUserSearch,onChange:e.onUserDropdownOptionSelect,placeholder:t.getTranslation("searchPlaceholder"),fluid:!0,search:!0,selection:!0,value:"",options:e.userDropdownOptions,loading:e.userSearchLoading}))),r),d.a.createElement(q.a,{className:"message-container",xs:9},n&&d.a.createElement(_.a,{className:"profile-tab chat-profile-tab"},d.a.createElement(q.a,null,d.a.createElement(me,{firstLetter:n.firstName[0].toUpperCase()}))),n&&d.a.createElement(_.a,{onScroll:e.onMessageScroll,className:"scrollable messages"},d.a.createElement(q.a,null,d.a.createElement(le.a,{className:"message-loader",active:e.loaderActive}),s)),n&&d.a.createElement(_.a,{className:"send-message"},d.a.createElement(q.a,null,d.a.createElement(ue.a,{onKeyDown:o,className:"message-input",size:"mini",placeholder:t.getTranslation("typeMessagePlaceholder")}))))))})),pe=(a(409),X.decorateWithMobX(function(e){var t=e.user,n="".concat(t.firstName," ").concat(t.lastName);return n.length>15&&(n="".concat(n.substring(0,15),"...")),d.a.createElement(_.a,{style:{backgroundColor:e.selected?"#f7f7f7":"white"},className:"user-card-container"},d.a.createElement(q.a,null,d.a.createElement("div",{onClick:function(){return e.onClick(t.email)},className:"user-card"},d.a.createElement(me,{firstLetter:n[0].toUpperCase(),size:"medium"}),d.a.createElement("div",{className:"user-card-text-group"},d.a.createElement("h1",null," ",n," ")),d.a.createElement("div",{className:"user-card-options"},e.unseenMessages>0&&d.a.createElement("div",{className:"count-bubble"},e.unseenMessages),d.a.createElement("img",{onClick:function(a){a.stopPropagation(),e.onCloseUserCard(t.email)},className:"close-user-card",src:a(410)})))))})),fe=(a(411),function(e){function t(){return Object(w.a)(this,t),Object(I.a)(this,Object(z.a)(t).apply(this,arguments))}return Object(W.a)(t,e),Object(E.a)(t,[{key:"render",value:function(){return d.a.createElement(_.a,null,d.a.createElement("div",{ref:this.props.messageRef,className:this.props.left?"message-card-container-left":"message-card-container-right",xs:1},d.a.createElement(q.a,{className:"message-card ".concat(this.props.left?"message-card-left":"message-card-right")},this.props.username&&d.a.createElement("h6",{className:"message-user"}," ",this.props.username," "),d.a.createElement("p",null,this.props.message,d.a.createElement("small",null,this.props.timestamp)))))}}]),t}(b.Component)),ge=a(75),be=a.n(ge);function de(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),a.push.apply(a,n)}return a}function ve(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?de(a,!0).forEach(function(t){Object(re.a)(e,t,a[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):de(a).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))})}return e}var ye=Object(k.b)("authentication")(g=Object(k.c)(g=function(e){function t(e){var a;return Object(w.a)(this,t),(a=Object(I.a)(this,Object(z.a)(t).call(this,e))).currentPage=0,a.unseenMessagesMap={},a.state={messages:[],userDropdownOptions:{},selectedUsers:{},userSearchLoading:!1,recipient:null,loaderActive:!1},a.attachSocketIOHandler(),a}return Object(W.a)(t,e),Object(E.a)(t,[{key:"attachSocketIOHandler",value:function(){var e=this,t=window.location,a=t.protocol,n=t.hostname,r=t.port,s="".concat(a,"//").concat(n,":").concat(parseInt(r,10)+1);this.socket=oe()(s),this.socket.on(this.props.authentication.token,function(t){if(e.state.recipient&&(e.state.recipient.email===t.to||e.state.recipient.email===t.from&&t.to===e.props.authentication.email)&&e.state.recipient.email!==e.props.authentication.email){var a=Object(se.a)(e.state.messages);a.push(d.a.createElement(fe,{messageRef:e.messageRef,key:Math.random(),message:t.message,timestamp:be()(t.createdDate).format("hh:mm a"),right:t.from===e.props.authentication.email,left:t.from!==e.props.authentication.email})),e.setMessagesState(a)}else t.from!==e.props.authentication.email&&(t.from in e.unseenMessagesMap?e.unseenMessagesMap[t.from]+=1:e.unseenMessagesMap[t.from]=1,e.forceUpdate())})}},{key:"onLogout",value:function(){var e=Object(P.a)(R.a.mark(function e(){var t;return R.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.props.authentication,e.prev=1,e.next=4,Z.logout(t.token);case 4:t.refreshAuthentication(),e.next=15;break;case 7:if(e.prev=7,e.t0=e.catch(1),!e.t0||!e.t0.response||403!==e.t0.response.status){e.next=13;break}this.props.history.push("/login"),e.next=15;break;case 13:if(!e.t0){e.next=15;break}throw e.t0;case 15:case"end":return e.stop()}},e,this,[[1,7]])}));return function(){return e.apply(this,arguments)}}()},{key:"onMessageScroll",value:function(e){var t=this,a=e.target&&e.target.scrollTop;this.scrollHeight=e.target&&e.target.scrollHeight,this.currentPage>0&&0===a&&this.state.recipient&&!this.state.recipient.allMessagesRetrieved&&this.state.messages&&this.state.messages.length>="15"&&this.setState({loaderActive:!0},Object(P.a)(R.a.mark(function e(){var a;return R.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,te.getConversation(t.state.recipient.email,++t.currentPage,"15",t.props.authentication.token);case 3:if(a=e.sent,t.unseenMessagesMap[t.state.recipient.email]=a.unseenItems,!(a=a.items)||0!==a.length){e.next=8;break}return e.abrupt("return",t.setState({loaderActive:!1,recipient:ve({},t.state.recipient,{allMessagesRetrieved:!0})}));case 8:t.setState({loaderActive:!1},function(){for(var e=Object(se.a)(t.state.messages),n=[],r=a.length-1;r>=0;--r){var s=a[r];t.messageRef=d.a.createRef(),n.push(d.a.createElement(fe,{messageRef:t.messageRef,key:Math.random(),message:s.message,timestamp:be()(s.createdDate).format("hh:mm a"),right:s.from===t.props.authentication.email,left:s.from!==t.props.authentication.email}))}t.state.recipient&&!t.state.recipient.allMessagesRetrieved&&t.setState({messages:n.concat(e)},function(){t.messageRef.current.scrollIntoView()})}),e.next=14;break;case 11:e.prev=11,e.t0=e.catch(0),t.setState({loaderActive:!1},function(){if(e.t0&&e.t0.response&&403===e.t0.response.status)t.props.history.push("/login");else if(e.t0)throw e.t0});case 14:case"end":return e.stop()}},e,null,[[0,11]])})))}},{key:"onUserSearch",value:function(e){var t=this,a=e.currentTarget.value;a&&this.setState({userSearchLoading:!0},Object(P.a)(R.a.mark(function e(){var n,r,s;return R.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.props.authentication,e.prev=1,e.next=4,ee.search(a,n.token);case 4:r=e.sent,s={},r.forEach(function(e){var t=e.email;s[t]=e}),t.setState({userSearchLoading:!1,userDropdownOptions:s}),e.next=13;break;case 10:e.prev=10,e.t0=e.catch(1),t.setState({userSearchLoading:!1},function(){if(e.t0&&e.t0.response&&403===e.t0.response.status)t.props.history.push("/login");else if(e.t0)throw e.t0});case 13:case"end":return e.stop()}},e,null,[[1,10]])})))}},{key:"onUserDropdownOptionSelect",value:function(){var e=Object(P.a)(R.a.mark(function e(t,a){var n,r,s,i,o;return R.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:n=a.value,"ArrowDown"!==(r=t.key)&&"ArrowUp"!==r&&(s=this.state.userDropdownOptions[n],i=ve({},this.state.selectedUsers),o={recipient:s,userDropdownOptions:{}},s.email in this.state.selectedUsers||(i[n]=s,o.selectedUsers=i),this.setMessages(n,o));case 3:case"end":return e.stop()}},e,this)}));return function(t,a){return e.apply(this,arguments)}}()},{key:"onUserClick",value:function(){var e=Object(P.a)(R.a.mark(function e(t){return R.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:this.setState({recipient:this.state.selectedUsers[t]}),this.setMessages(t);case 2:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"setMessagesState",value:function(e,t){var a=this;this.setState(ve({messages:e},t),function(){a.messageRef&&a.messageRef.current&&a.messageRef.current.scrollIntoView()})}},{key:"setMessages",value:function(e,t){var a=this;this.setState({loaderActive:!0},Object(P.a)(R.a.mark(function n(){var r;return R.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,te.getConversation(e,1,"15",a.props.authentication.token);case 3:r=n.sent,a.unseenMessagesMap[e]=r.unseenItems,r=r.items,a.setState({loaderActive:!1},function(){a.currentPage=1;for(var e=[],n=r.length-1;n>=0;--n){var s=r[n];a.messageRef=d.a.createRef(),e.push(d.a.createElement(fe,{messageRef:a.messageRef,key:Math.random(),message:s.message,timestamp:be()(s.createdDate).format("hh:mm a"),right:s.from===a.props.authentication.email,left:s.from!==a.props.authentication.email}))}a.setMessagesState(e,t)}),n.next=12;break;case 9:n.prev=9,n.t0=n.catch(0),a.setState({loaderActive:!0},function(){if(n.t0&&n.t0.response&&403===n.t0.response.status)a.props.history.push("/login");else if(n.t0)throw n.t0});case 12:case"end":return n.stop()}},n,null,[[0,9]])})))}},{key:"sendMessage",value:function(){var e=Object(P.a)(R.a.mark(function e(t){var a,n;return R.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(a=t.currentTarget.value,t.currentTarget.value="",a){e.next=4;break}return e.abrupt("return");case 4:return e.prev=4,e.next=7,te.sendMessage({to:this.state.recipient.email,message:a},this.props.authentication.token);case 7:e.sent.status>=200&&(this.messageRef=d.a.createRef(),(n=Object(se.a)(this.state.messages)).push(d.a.createElement(fe,{messageRef:this.messageRef,key:Math.random(),message:a,timestamp:be()().format("hh:mm a"),right:!0})),this.setMessagesState(n)),e.next=19;break;case 11:if(e.prev=11,e.t0=e.catch(4),!e.t0||!e.t0.response||403!==e.t0.response.status){e.next=17;break}this.props.history.push("/login"),e.next=19;break;case 17:if(!e.t0){e.next=19;break}throw e.t0;case 19:case"end":return e.stop()}},e,this,[[4,11]])}));return function(t){return e.apply(this,arguments)}}()},{key:"onSendMessage",value:function(e){"Enter"===e.key&&this.sendMessage(e)}},{key:"onCloseUserCard",value:function(e){var t=ve({},this.state.selectedUsers);delete t[e];var a=this.state.recipient;a&&"object"===typeof a&&a.email===e&&(a=null,this.currentPage=0),this.setState({selectedUsers:t,recipient:a})}},{key:"render",value:function(){var e=this,t=this.props.authentication,a=t.id,n=t.email,r=t.firstName,s=t.lastName;return d.a.createElement(he,{user:{id:a,email:n,firstName:r,lastName:s},recipient:this.state.recipient,selectedUsers:Object.keys(this.state.selectedUsers).map(function(t){var a=e.state.selectedUsers[t],n=e.unseenMessagesMap[a.email];return d.a.createElement(pe,{onClick:e.onUserClick.bind(e),key:a.id,user:a,selected:a.email===(e.state.recipient&&e.state.recipient.email),onCloseUserCard:e.onCloseUserCard.bind(e),unseenMessages:n})}),userDropdownOptions:Object.keys(this.state.userDropdownOptions).map(function(t){var a=e.state.userDropdownOptions[t],n=a.id,r=a.email,s=a.firstName,i=a.lastName;return{key:n,value:r,text:"".concat(s," ").concat(i)}}),userSearchLoading:this.state.userSearchLoading,messages:this.state.messages,onSendMessage:this.onSendMessage.bind(this),onLogout:this.onLogout.bind(this),onUserSearch:this.onUserSearch.bind(this),onUserDropdownOptionSelect:this.onUserDropdownOptionSelect.bind(this),onMessageScroll:this.onMessageScroll.bind(this),loaderActive:this.state.loaderActive})}}]),t}(b.Component))||g)||g,ke=Object(D.g)(ye),Oe=X.decorateWithMobX(function(e){var t=e.authentication;return d.a.createElement(D.d,null,d.a.createElement(D.b,{path:"/login"},d.a.createElement(ne,null)),d.a.createElement(D.b,{path:"/register"},d.a.createElement(ne,{register:!0})),d.a.createElement(D.b,{path:"/home"},t.token?d.a.createElement(ke,null):d.a.createElement(D.a,{to:"/login"})),d.a.createElement(D.b,{path:"/"},t.nonObservableToken?d.a.createElement(D.a,{to:"/home"}):d.a.createElement(D.a,{to:"login"})))});Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));a(412);y.a.render(d.a.createElement(function(){return d.a.createElement(U.a,null,d.a.createElement(k.a,{message:new A,authentication:new C,translation:new x},d.a.createElement(Oe,null)))},null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})}},[[229,1,2]]]);
//# sourceMappingURL=main.ffddfea3.chunk.js.map